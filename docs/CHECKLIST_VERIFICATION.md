# Пошаговая проверка после деплоя

Открывайте приложение в Telegram (Mini App) или в браузере по вашему URL. Роли: **клиент**, **склад**, **админ** — в зависимости от аккаунта.

---

## 1. Вход и компания (клиент)

1. Откройте приложение.
2. Дождитесь загрузки («Загрузка профиля...» исчезнет).
3. Перейдите: **Клиент** → **Компании** (или сразу откроется «Компании»).
4. Выберите компанию из списка (или создайте, если пусто).
5. Убедитесь, что компания выбрана — дальше заявки и товары привязаны к ней.

---

## 2. Товары (для заявки)

1. Внизу перейдите: **Товары**.
2. Убедитесь, что есть хотя бы один товар.
3. Если нет — создайте товар (кнопка «Добавить товар» / форма), иначе заявку не создать.

---

## 3. Адреса/склады (админ) — для «разные склады»

1. Переключитесь на вкладку **Админка** (если роль admin).
2. Откройте **Адреса** (`/admin/destinations`).
3. Проверьте, что есть активные «назначения» (склады/адреса) — они подставляются в заявку по строкам.
4. При необходимости добавьте или отредактируйте адрес.

---

## 4. Заявка с разными складами и количеством (главная новая фича)

1. Перейдите: **Клиент** → **Заявки**.
2. Нажмите кнопку создания заявки (например, «Новая заявка» / переход к форме).
3. В форме заявки:
   - Выберите **товар** в первой строке, укажите **количество**.
   - Если есть адреса — в этой же строке выберите **Склад / назначение** (выпадающий список или «Свой вариант»).
   - Нажмите **«Добавить позицию»**.
   - Во второй строке выберите другой товар или тот же товар, другое количество и/или другой склад.
4. Нажмите **«Создать заявку»**.
5. Ожидание: заявка создаётся, вы попадаете в список заявок или на карточку заявки.

**Что проверить:** одна заявка содержит несколько позиций с разными складами и разным количеством без ошибки «Duplicate products».

---

## 5. Карточка заявки (позиции и приёмка)

1. В разделе **Заявки** откройте только что созданную заявку (тап по карточке или «Подробнее»).
2. Проверьте блок **«Позиции»**:
   - У каждой строки отображаются: товар, план/принято/брак.
   - Если по строке был выбран склад — должна быть подпись вида **«Склад: …»** (название назначения).
3. Проверьте кнопку:
   - Текст кнопки: **«Отправить приёмку в Telegram»** (не «Скачать приёмку (Excel)»).
   - Нажатие отправляет файл приёмки в чат с ботом (при привязанном Telegram у компании).
4. При наличии записей упаковки проверьте блок **«Упаковка»** — он подгружается и отображается без ошибок.

---

## 6. Настройки AI (админ)

1. Перейдите: **Админка** → **AI** (`/admin/ai-settings`).
2. Очистите поле **«Модель»** и нажмите **«Сохранить»**:
   - Должно появиться сообщение об ошибке (например, «Укажите модель»), сохранение не должно проходить.
3. Введите корректную модель (например, `gpt-4o-mini`), нажмите **«Сохранить»**:
   - Должно появиться сообщение об успешном сохранении.
4. По желанию нажмите **«Тестовый запрос»** — ответ от AI без ошибок.

---

## 7. Склад: приёмка и упаковка (если роль warehouse/admin)

1. Перейдите: **Склад** → **Приёмка**.
2. Выберите заявку, введите принятые/брак количества по позициям, завершите приёмку — ошибок нет.
3. Перейдите: **Склад** → **Упаковка**.
4. В списке — заявки только в статусах **Принято**, **Упаковка**, **Готово к отгрузке**. Выберите заявку со статусом **Принято**.
5. В форме упаковки выбор **по позиции заявки** (товар, назначение, план по строке). Укажите позицию, количество, палета/короб (числа), сохраните. Статус заявки станет **Упаковка** или **Готово к отгрузке** (не «Завершено»).
6. **Перепаковка:** попробуйте упаковать больше, чем (принято − брак − уже упаковано) по позиции — должна быть ошибка.
7. **Упаковка до приёмки:** у заявки «Новая» упаковка недоступна или отклоняется.
8. **Завершение:** в статусе «Готово к отгрузке» нажмите **Завершить**. Статус → **Завершено**. В Telegram — **одно** сообщение о завершении (не серия «Упаковано +1»).

---

## 8. Карточка заявки: упаковано по позициям

1. Откройте заявку, по которой уже делали упаковку.
2. В блоке **Позиции** у каждой строки — **Упаковано: N**. Блок **Упаковка** (история) загружается без ошибок.

---

## 9. Краткий чек-лист

| Шаг | Действие | Ожидание |
|-----|----------|----------|
| 1 | Открыть приложение, выбрать компанию | Компания выбрана |
| 2 | Клиент → Товары | Есть хотя бы один товар |
| 3 | Админ → Адреса | Есть назначения для складов |
| 4 | Клиент → Заявки → новая заявка, 2+ позиции, разные склады/количество | Заявка создана |
| 5 | Открыть заявку → Позиции | «Склад: …», «Упаковано: N» по строкам, кнопка «Отправить приёмку в Telegram» |
| 6 | Админ → AI | Валидация модели (пусто = ошибка), сохранение с моделью = ок |
| 7 | Склад → Приёмка → Упаковка | Упаковка по позициям; перепаковка отклоняется; одно уведомление в TG при завершении |
| 8 | Карточка заявки после упаковки | По каждой позиции «Упаковано: N», блок Упаковка без ошибок |

После прохождения пунктов 1–8 новая логика (разные склады, упаковка по позициям, статусы, защита от перепаковки, одно уведомление при завершении) считается проверенной.
