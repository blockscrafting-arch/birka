# Пошаговая проверка после деплоя

Открывайте приложение в Telegram (Mini App) или в браузере по вашему URL. Роли: **клиент**, **склад**, **админ** — в зависимости от аккаунта.

---

## 1. Вход и компания (клиент)

1. Откройте приложение.
2. Дождитесь загрузки («Загрузка профиля...» исчезнет).
3. Перейдите: **Клиент** → **Компании** (или сразу откроется «Компании»).
4. Выберите компанию из списка (или создайте, если пусто).
5. Убедитесь, что компания выбрана — дальше заявки и товары привязаны к ней.

---

## 2. Товары (для заявки)

1. Внизу перейдите: **Товары**.
2. Убедитесь, что есть хотя бы один товар.
3. Если нет — создайте товар (кнопка «Добавить товар» / форма), иначе заявку не создать.

---

## 3. Адреса/склады (админ) — для «разные склады»

1. Переключитесь на вкладку **Админка** (если роль admin).
2. Откройте **Адреса** (`/admin/destinations`).
3. Проверьте, что есть активные «назначения» (склады/адреса) — они подставляются в заявку по строкам.
4. При необходимости добавьте или отредактируйте адрес.

---

## 4. Заявка с разными складами и количеством (главная новая фича)

1. Перейдите: **Клиент** → **Заявки**.
2. Нажмите кнопку создания заявки (например, «Новая заявка» / переход к форме).
3. В форме заявки:
   - Выберите **товар** в первой строке, укажите **количество**.
   - Если есть адреса — в этой же строке выберите **Склад / назначение** (выпадающий список или «Свой вариант»).
   - Нажмите **«Добавить позицию»**.
   - Во второй строке выберите другой товар или тот же товар, другое количество и/или другой склад.
4. Нажмите **«Создать заявку»**.
5. Ожидание: заявка создаётся, вы попадаете в список заявок или на карточку заявки.

**Что проверить:** одна заявка содержит несколько позиций с разными складами и разным количеством без ошибки «Duplicate products».

---

## 5. Карточка заявки (позиции и приёмка)

1. В разделе **Заявки** откройте только что созданную заявку (тап по карточке или «Подробнее»).
2. Проверьте блок **«Позиции»**:
   - У каждой строки отображаются: товар, план/принято/брак.
   - Если по строке был выбран склад — должна быть подпись вида **«Склад: …»** (название назначения).
3. Проверьте кнопку:
   - Текст кнопки: **«Отправить приёмку в Telegram»** (не «Скачать приёмку (Excel)»).
   - Нажатие отправляет файл приёмки в чат с ботом (при привязанном Telegram у компании).
4. При наличии записей упаковки проверьте блок **«Упаковка»** — он подгружается и отображается без ошибок.

---

## 6. Настройки AI (админ)

1. Перейдите: **Админка** → **AI** (`/admin/ai-settings`).
2. Очистите поле **«Модель»** и нажмите **«Сохранить»**:
   - Должно появиться сообщение об ошибке (например, «Укажите модель»), сохранение не должно проходить.
3. Введите корректную модель (например, `gpt-4o-mini`), нажмите **«Сохранить»**:
   - Должно появиться сообщение об успешном сохранении.
4. По желанию нажмите **«Тестовый запрос»** — ответ от AI без ошибок.

---

## 7. Склад: приёмка и упаковка (если роль warehouse/admin)

1. Перейдите: **Склад** → **Приёмка**.
2. Выберите заявку, введите принятые/брак количества по позициям, завершите приёмку — ошибок нет.
3. Перейдите: **Склад** → **Упаковка**.
4. Выберите заявку, заполните позиции (товар, количество, при необходимости палета/короб — числа), сохраните.
5. Ожидание: палета и короб сохраняются как числа, без ошибок валидации (пустые поля не уходят как пустые строки).

---

## 8. Краткий чек-лист

| Шаг | Действие | Ожидание |
|-----|----------|----------|
| 1 | Открыть приложение, выбрать компанию | Компания выбрана |
| 2 | Клиент → Товары | Есть хотя бы один товар |
| 3 | Админ → Адреса | Есть назначения для складов |
| 4 | Клиент → Заявки → новая заявка, 2+ позиции, разные склады/количество | Заявка создана |
| 5 | Открыть заявку → Позиции | Видны «Склад: …» по строкам, кнопка «Отправить приёмку в Telegram» |
| 6 | Админ → AI | Валидация модели (пусто = ошибка), сохранение с моделью = ок |
| 7 | Склад → Упаковка (по желанию) | Палета/короб — числа, форма сохраняется без ошибок |

После прохождения пунктов 1–6 основная новая логика (разные склады и количество, кнопка приёмки, настройки AI) считается проверенной.
